<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>출퇴근 기록 테스트</title>
    <style>
        /* 기본 스타일 */
        body {
            font-family: Arial, sans-serif;
            margin: 0;                 /* ← 불균형 원인인 margin 제거 */
            padding: 16px;             /* ← 좌우 여백 균등하게 */
            box-sizing: border-box;    /* ← 패딩 포함해서 폭 계산 */
            background-color: #f7f7f7;
        }
        h1 { text-align: center; color: #333; }
        h2 { color: #555; margin-top: 20px; }

        form, .container {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-sizing: border-box; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-top: 20px;
            width: 100%;
        }

        label {
            width: 100%;
            display: block;
            margin-bottom: 10px;
            color: #333;
            box-sizing: border-box; 
        }

        input[type="text"], input[type="date"], input[type="time"], input[type="number"] {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }

        button {
            width: 100%;
            padding: 12px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            box-sizing: border-box;
        }

        button:hover { background-color: #45a049; }

        pre {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px #0000001a;
            white-space: pre-wrap;
            word-wrap: break-word;
            box-sizing: border-box;
        }

        /* 테이블 스타일 */
        #workTimeTable {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 15px;
            font-family: 'Arial', sans-serif;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            font-size: 12px;
        }

        #workTimeTable th, #workTimeTable td {
            padding: 10px;
            text-align: center;
        }

        #workTimeTable thead {
            background: linear-gradient(135deg, #404040, #404040);
            color: #fff;
            font-weight: bold;
        }

        #workTimeTable tbody tr {
            background-color: #ffffff;
            transition: all 0.3s ease;
        }

        #workTimeTable tbody tr:hover {
            background-color: #ffffff;
            transform: scale(1.02);
            cursor: pointer;
        }

        #workTimeTable th:first-child { border-top-left-radius: 12px; }
        #workTimeTable th:last-child { border-top-right-radius: 12px; }
        #workTimeTable td:first-child { border-bottom-left-radius: 12px; }
        #workTimeTable td:last-child { border-bottom-right-radius: 12px; }

        /* PC 화면 유지용 */
        @media (min-width: 600px) {
            body { max-width: 600px; margin: 40px auto; padding: 0 20px; }
            #workTimeTable { font-size: 14px; }
        }
    </style>
</head>
<body>

<!-- POST: 출퇴근 기록 저장 -->
<div class="container">
    <h2>출퇴근 기록</h2>
    <label>사용자 ID: <input type="number" id="postUserId" value="1"></label>
    <label>날짜: <input type="date" id="postWorkDate"></label>
    <label>출근 시간: <input type="time" id="postStartTime" value="08:50" ></label>
    <label>퇴근 시간: <input type="time" id="postEndTime"></label>
    <button id="saveData">저장</button>
    <pre id="postOutput">결과가 여기에 표시됩니다.</pre>
</div>

<!-- GET: 출퇴근 기록 조회 -->
<div class="container">
    <h2>출퇴근 기록 조회</h2>
    <label>사용자 ID: <input type="number" id="getUserId" value="1"></label>
    <label>날짜: <input type="date" id="getWorkDate" value="2025-11-11"></label>
    <button id="loadData">불러오기</button>

    <table id="workTimeTable">
        <thead>
            <tr>
                <th>근무일</th>
                <th>출근</th>
                <th>퇴근</th>
                <th>총 근무시간</th>
                <th>잔업시간</th>
                <th>현장</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
const apiUrl = "http://localhost:8080/worktime";
//const apiUrl = "http://13.231.93.50:8080/worktime";

 // 현재 시각 기준으로 날짜, 시간 구하기
  const now = new Date();

  // 날짜 형식 yyyy-mm-dd 로 변환
  const dateStr = now.toISOString().split('T')[0];

  // 시간 형식 hh:mm 으로 변환
  const pad = n => n.toString().padStart(2, '0');
  const timeStr = `${pad(now.getHours())}:${pad(now.getMinutes())}`;

  // 요소에 값 설정
  document.getElementById("postWorkDate").value = dateStr;
  document.getElementById("postEndTime").value = timeStr; // 퇴근시간도 기본값은 현재시간
// POST: 기록 저장
document.getElementById("saveData").addEventListener("click", function() {
    const data = {
        userId: parseInt(document.getElementById("postUserId").value),
        workDate: document.getElementById("postWorkDate").value,
        startTime: document.getElementById("postWorkDate").value + "T" + document.getElementById("postStartTime").value,
        endTime: document.getElementById("postWorkDate").value + "T" + document.getElementById("postEndTime").value
    };

    fetch(`${apiUrl}/record`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    })
    .then(res => res.text())
    .then(msg => { document.getElementById("postOutput").textContent = msg; })
    .catch(err => alert("저장 오류: " + err));
});

// GET: 기록 조회
document.getElementById("loadData").addEventListener("click", function() {
    const userId = parseInt(document.getElementById("getUserId").value);
    const workDate = document.getElementById("getWorkDate").value;

    fetch(`${apiUrl}/${userId}?workDate=${workDate}`)
        .then(res => res.json())
        .then(data => {
            const tbody = document.querySelector("#workTimeTable tbody");
            tbody.innerHTML = "";

            data.forEach(item => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${item.workDate}</td>
                    <td>${item.startTime.split("T")[1]}</td>
                    <td>${item.endTime.split("T")[1]}</td>
                    <td>${item.totalHours}</td>
                    <td>${item.overtime}</td>
                    <td>${item.worktype}</td>
                `;
                tbody.appendChild(tr);
            });
        })
        .catch(err => alert("조회 오류: " + err));
});


</script>

</body>
</html>
